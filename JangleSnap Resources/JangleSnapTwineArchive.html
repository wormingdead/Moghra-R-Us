<tw-storydata name="JangleSnap Demo" startnode="2" creator="Twine" creator-version="2.3.15" ifid="57587E33-5DB3-40C2-9EC6-46771C27ADCE" zoom="1" format="Harlowe" format-version="3.2.3" options="" hidden><style role="stylesheet" id="twine-user-stylesheet" type="text/twine-css">tw-story select {
  background-color: black;
}</style><script role="script" id="twine-user-script" type="text/twine-javascript"></script><tw-passagedata pid="1" name="Character Setup" tags="startup" position="200,300" size="100,100">{=
(set: $cmCreatureCreate to (macro:
	str-type _name,
	array-type _stats,
	array-type _mutations,
	array-type _cybernetics,
[
	(output-data:(dm:
		&quot;name&quot;,_name,
		&quot;stats&quot;,_stats,
		&quot;mutations&quot;,_mutations,
		&quot;cybernetics&quot;,_cybernetics
	))
]))

(set: $strPCNameDefault to &quot;Traveler&quot;)
(set: $strNPCNameDefault to &quot;Unnamed Snapjaw&quot;)

(set: $arStatsDefault to (a:
	(dm:
		&quot;name&quot;,&quot;Strength&quot;,
		&quot;label&quot;,&quot;STR&quot;,
		&quot;value&quot;,&quot;16&quot;
	),
	(dm:
		&quot;name&quot;,&quot;Agility&quot;,
		&quot;label&quot;,&quot;AGI&quot;,
		&quot;value&quot;,&quot;16&quot;
	),
	(dm:
		&quot;name&quot;,&quot;Toughness&quot;,
		&quot;label&quot;,&quot;TOU&quot;,
		&quot;value&quot;,&quot;16&quot;
	),
	(dm:
		&quot;name&quot;,&quot;Intelligence&quot;,
		&quot;label&quot;,&quot;INT&quot;,
		&quot;value&quot;,&quot;16&quot;
	),
	(dm:
		&quot;name&quot;,&quot;Wisdom&quot;,
		&quot;label&quot;,&quot;WIS&quot;,
		&quot;value&quot;,&quot;16&quot;
	),
	(dm:
		&quot;name&quot;,&quot;Ego&quot;,
		&quot;label&quot;,&quot;EGO&quot;,
		&quot;value&quot;,&quot;16&quot;
	)
))

(set: $arStatValueRange to (altered:_v via (str:_v), ...(range:3,40)))

(set: $cmGetStatValueMod to
(macro: num-type _stat, [
	(if: _stat &gt;= 16)[(output-data:(floor:(_stat - 16) / 2))]
	(else:)[(output-data:(ceil:(_stat - 16) / 2))]
]))

(set: $dmCreatures to (dm:
	&quot;pc&quot;,
		($cmCreatureCreate:
			$strPCNameDefault,
			$arStatsDefault,
			(a:),
			(a:)
		)
	,
	&quot;npc&quot;,
		($cmCreatureCreate:
			$strNPCNameDefault,
			$arStatsDefault,
			(a:),
			(a:)
		)
))</tw-passagedata><tw-passagedata pid="2" name="Main Menu" tags="" position="400,300" size="100,100">(box:&quot;=XX=&quot;)[=
#JangleSnap Demo

[TODO] Tutorial

[[Start-&gt;New Game]]

(link-reveal-goto:
	&quot;Edit your character&quot;,
	&quot;Creature Editor&quot;
)[(set: $strEditorTarget to &quot;pc&quot;)]

(link-reveal-goto:
	&quot;Edit your opponent&quot;,
	&quot;Creature Editor&quot;
)[(set: $strEditorTarget to &quot;npc&quot;)]</tw-passagedata><tw-passagedata pid="3" name="Game Setup" tags="startup" position="200,700" size="100,100">{=
(set: $arGamePositions to
(a:
	&quot;Wanderer&quot;,
	&quot;Merchant&quot;,
	&quot;Pilgrim&quot;,
	&quot;Ascendant&quot;
))

(set: $arGameDiceSets to
(a:
	&quot;foraging&quot;,
	&quot;scavenging&quot;
))

(set: $cmCreateGameState to
(macro:
	datamap-type _playerCreature,
	datamap-type _npcCreature,
[
	(output-data:(dm:
		1st of $arGameDiceSets,(dm:
			&quot;creature&quot;,_playerCreature,
			&quot;dice&quot;,(a:
				($cmCreateDie:&quot;d6&quot;),
				($cmCreateDie:&quot;d6&quot;)
			),
			&quot;position&quot;,1st of $arGamePositions
		),
		2nd of $arGameDiceSets,(dm:
			&quot;creature&quot;,_npcCreature,
			&quot;dice&quot;,(a:
				($cmCreateDie:&quot;d4&quot;),
				($cmCreateDie:&quot;d6&quot;)
			),
			&quot;position&quot;,1st of $arGamePositions
		)
	))
]))

(set: $cmDiceSetInvert to
(macro: string-type _diceSet, [
	(output-data: (cond:
		_diceSet is 1st of $arGameDiceSets,2nd of $arGameDiceSets
		_diceSet is 2nd of $arGameDiceSets,1st of $arGameDiceSets
	))
]))</tw-passagedata><tw-passagedata pid="4" name="Game State" tags="" position="800,300" size="100,100">{=
(align:&quot;=&gt;&lt;=&quot;)+(b4r:&quot;none&quot;,&quot;none&quot;,&quot;dotted&quot;)+(b4r-colour:white)+(box:&quot;=XXXXXX=&quot;)[
=|=
#####$strPlayerName
=|=
#####STR (print:STR of $dmStatsPlayer)
=|=
#####AGI (print:AGI of $dmStatsPlayer)
=|=
#####TOU (print:TOU of $dmStatsPlayer)
=|=
#####INT (print:INT of $dmStatsPlayer)
=|=
#####WIS (print:WIS of $dmStatsPlayer)
=|=
#####EGO (print:EGO of $dmStatsPlayer)
|==|
]
(align:&quot;=&gt;&lt;=&quot;)+(box:&quot;=X=&quot;)[######Opponent in (print:$strGamePositionOpponent) Position
######(print:$strOpponentName)&#39;s Side &gt;]

(display:&quot;Game Board&quot;)

(align:&quot;=&gt;&lt;=&quot;)+(box:&quot;=X=&quot;)[######&lt; Your Side
######You are in (print:$strGamePositionPlayer) Position]</tw-passagedata><tw-passagedata pid="5" name="New Game" tags="" position="600,300" size="100,100">{=
(set: $dmGameState to ($cmGameStateCreate:
	$dmPlayerCreature,
	$dmNPCCreature
))

(display: &quot;Game UI&quot;)
(display: &quot;Game Choices&quot;)</tw-passagedata><tw-passagedata pid="6" name="Game Board" tags="" position="800,500" size="100,100">{=
(align:&quot;=&gt;&lt;=&quot;)+(box:&quot;=XXXXXX=&quot;)[=
=|=
(for: each _die, ...$arDiceZonePlayer)[
($cmDiePrint:_die)
]
=|=
(for: each _die, ...$arDiceZoneOpponent)[
($cmDiePrint:_die)
]
|==|</tw-passagedata><tw-passagedata pid="7" name="Pass Scavenging die" tags="" position="1000,700" size="100,100">{=
(set: _arDiceSetScavenging to (a:
	($cmDieCreate:&quot;Scavenging&quot;),
	($cmDieCreate:&quot;Foraging&quot;)
))

(set: _arDiceSetForaging to (a:
	($cmDieCreate:&quot;Foraging&quot;),
	($cmDieCreate:&quot;Foraging&quot;)
))

(move: _arDiceSetForaging into $arDiceZonePlayer)
(move: _arDiceSetScavenging into $arDiceZoneOpponent)


(display: &quot;Game State&quot;)
(display: &quot;Game Choices&quot;)</tw-passagedata><tw-passagedata pid="8" name="Keep Scavenging die" tags="" position="1000,900" size="100,100">{=
(set: _arDiceSetScavenging to (a:
	($cmDieCreate:&quot;Scavenging&quot;),
	($cmDieCreate:&quot;Foraging&quot;)
))

(set: _arDiceSetForaging to (a:
	($cmDieCreate:&quot;Foraging&quot;),
	($cmDieCreate:&quot;Foraging&quot;)
))

(move: _arDiceSetScavenging into $arDiceZonePlayer)
(move: _arDiceSetForaging into $arDiceZoneOpponent)


(display: &quot;Game State&quot;)
(display: &quot;Game Choices&quot;)</tw-passagedata><tw-passagedata pid="9" name="Roll Foraging" tags="" position="1000,1100" size="100,100">{=
(set: _arDiceSetScavenging to (a:
	($cmDieCreate:&quot;Scavenging&quot;),
	($cmDieCreate:&quot;Foraging&quot;)
))

(set: _arDiceSetForaging to (a:
	($cmDieCreate:&quot;Foraging&quot;),
	($cmDieCreate:&quot;Foraging&quot;)
))

(if: (either: &quot;Scavenging&quot;, &quot;Foraging&quot;) is &quot;Scavenging&quot;)[
	(move: _arDiceSetScavenging into $arDiceZonePlayer)
	(move: _arDiceSetForaging into $arDiceZoneOpponent)
]
(else:)[
	(move: _arDiceSetForaging into $arDiceZonePlayer)
	(move: _arDiceSetScavenging into $arDiceZoneOpponent)
]


(display: &quot;Game State&quot;)
(display: &quot;Game Choices&quot;)</tw-passagedata><tw-passagedata pid="10" name="Game Choices" tags="" position="800,700" size="100,100">{=
(align:&quot;=&gt;&lt;=&quot;)+(box:&quot;=XXXXX=&quot;)[=
=|=
(box:&quot;=XXX=&quot;)[###Standard Actions]
(if: (find:_die where _die&#39;s kind is &quot;Scavenging&quot;, ...$arDiceZonePlayer)&#39;s length &gt; 0)[
[[Pass Scavenging die on roll-&gt;Pass Scavenging die]] &lt;br&gt;
[[Keep Scavenging die on roll-&gt;Keep Scavenging die]] &lt;br&gt;
]
(else:)[
[[Roll both Foraging dice-&gt;Roll Foraging]] &lt;br&gt;
]
=|=
(box:&quot;=XXX=&quot;)[###Ability Actions]
|==|</tw-passagedata><tw-passagedata pid="11" name="Dice Setup" tags="startup" position="200,500" size="100,100">{=
(set: $arDieSidesD4 to
(a:
	&quot;Turret&quot;   ,
	&quot;Moghra&#39;Yi&quot;,
	&quot;Shrine&quot;   ,
	&quot;Spindle&quot;
))

(set: $arDieSidesD6 to
(a:
	&quot;Young Ivory&quot;,
	&quot;Brinestalk&quot; ,
	&quot;Water Dram&quot; ,
	&quot;Brinestalk&quot; ,
	&quot;Water Dram&quot; ,
	&quot;Tonic&quot;
))

(set: $dmAbstractDie to (dm:
	&quot;colour&quot; ,transparent,
	&quot;effects&quot;,(a:),
	&quot;kind&quot;   ,&quot;&quot;,
	&quot;sides&quot;  ,(a:),
	&quot;value&quot;  ,&quot;&quot;
))

(set: $cmCreateDie to
(macro: string-type _dieKind, [
	(output-data:
		(cond:
			_dieKind is &quot;d4&quot;,
			$dmAbstractDie
			+ (dm:&quot;kind&quot;  ,&quot;d4&quot;)
			+ (dm:&quot;sides&quot; ,$arDieSidesD4)
			+ (dm:&quot;colour&quot;,red)
			,
			_dieKind is &quot;d6&quot;,
			$dmAbstractDie
			+ (dm:&quot;kind&quot;  ,&quot;d6&quot;)
			+ (dm:&quot;sides&quot; ,$arDieSidesD6)
			+ (dm:&quot;colour&quot;,grey)
		)
	)
]))

(set: $cmDieRoll to
(macro: datamap-type _die, [
	(output-data:_die + (dm:&quot;value&quot;,(either: ..._die&#39;s sides)))
]))

(set: $cmDiePrint to
(macro: datamap-type _die, [
	(output:)+(text-colour:_die&#39;s colour)[
		(cond:
			_die&#39;s value is &quot;&quot;,&quot;&quot;,
			_die&#39;s kind + &quot; result: &quot; + _die&#39;s value
		)
	]
]))

(set: $cmDieResult to
(macro: datamap-type _die, [
	(output-data:_die&#39;s value)
]))

(set: $cmDiceResult to
(macro:	array-type _dice, [
	(output-data:
		(sorted:(altered:_die via ($cmDieResult:_die), ..._dice))
	)
]))</tw-passagedata><tw-passagedata pid="12" name="Foraging Wanderer Roll Results" tags="" position="1200,500" size="100,100">{=
(set: $arFWRollResults to (a:
(dm:
	&quot;ruleName&quot;,&quot;FW Loss&quot;,
	&quot;diceSet&quot;,&quot;foraging&quot;,
	&quot;diceResults&quot;,(a:
		(a:&quot;Young Ivory&quot;,&quot;Young Ivory&quot;)
	),
	&quot;positions&quot;,(a:&quot;Wanderer&quot;),
	&quot;effects&quot;,(dm:
		&quot;position&quot;,&quot;Loss&quot;
	)
),

(dm:
	&quot;ruleName&quot;,&quot;FW Become Merchant&quot;,
	&quot;diceSet&quot;,&quot;foraging&quot;,
	&quot;diceResults&quot;,(a:
		(a:&quot;Water Dram&quot;,&quot;Water Dram&quot;)
	),
	&quot;positions&quot;,(a:&quot;Wanderer&quot;),
	&quot;effects&quot;,(dm:
		&quot;position&quot;,&quot;Merchant&quot;
	)
),

(dm:
	&quot;ruleName&quot;,&quot;FW No Change&quot;,
	&quot;diceSet&quot;,&quot;foraging&quot;,
	&quot;diceResults&quot;,(a:
		(a:&quot;Young Ivory&quot;,&quot;Brinestalk&quot;),
		(a:&quot;Young Ivory&quot;,&quot;Water Dram&quot;),
		(a:&quot;Young Ivory&quot;,&quot;Tonic&quot;),
		(a:&quot;Brinestalk&quot; ,&quot;Brinestalk&quot;),
		(a:&quot;Brinestalk&quot; ,&quot;Water Dram&quot;),
		(a:&quot;Brinestalk&quot; ,&quot;Tonic&quot;),
		(a:&quot;Water Dram&quot; ,&quot;Tonic&quot;),
		(a:&quot;Tonic&quot; ,&quot;Tonic&quot;)
	),
	&quot;positions&quot;,(a:&quot;Wanderer&quot;),
	&quot;effects&quot;,(dm:
		&quot;position&quot;,&quot;Wanderer&quot;
	)
)

))</tw-passagedata><tw-passagedata pid="13" name="Scavenging Wanderer Rolls Results" tags="" position="1400,500" size="100,100">{=
(set: $arSWRollResults to (a:
(dm:
	&quot;ruleName&quot;,&quot;SW Loss&quot;,
	&quot;diceSet&quot;,&quot;scavenging&quot;,
	&quot;diceResults&quot;,(a:
		(a:&quot;Turret&quot;,&quot;Young Ivory&quot;),
		(a:&quot;Turret&quot;,&quot;Water Dram&quot;),
		(a:&quot;Moghra&#39;Yi&quot;,&quot;Tonic&quot;)
	),
	&quot;positions&quot;,(a:&quot;Wanderer&quot;),
	&quot;effects&quot;,(dm:
		&quot;position&quot;,&quot;Loss&quot;
	)
),

(dm:
	&quot;ruleName&quot;,&quot;SW Become Pilgrim&quot;,
	&quot;diceSet&quot;,&quot;scavenging&quot;,
	&quot;diceResults&quot;,(a:
		(a:&quot;Shrine&quot;,&quot;Brinestalk&quot;)
	),
	&quot;positions&quot;,(a:&quot;Wanderer&quot;),
	&quot;effects&quot;,(dm:
		&quot;position&quot;,&quot;Pilgrim&quot;
	)
),

(dm:
	&quot;ruleName&quot;,&quot;SW Become Ascendant&quot;,
	&quot;diceSet&quot;,&quot;scavenging&quot;,
	&quot;diceResults&quot;,(a:
		(a:&quot;Spindle&quot;,&quot;Tonic&quot;)
	),
	&quot;positions&quot;,(a:&quot;Wanderer&quot;),
	&quot;effects&quot;,(dm:
		&quot;position&quot;,&quot;Ascendant&quot;
	)
),

(dm:
	&quot;ruleName&quot;,&quot;SW No Change&quot;,
	&quot;diceSet&quot;,&quot;scavenging&quot;,
	&quot;diceResults&quot;,(a:
		(a:&quot;Turret&quot; ,&quot;Brinestalk&quot;),
		(a:&quot;Turret&quot; ,&quot;Tonic&quot;),
		(a:&quot;Moghra&#39;Yi&quot;,&quot;Young Ivory&quot;),
		(a:&quot;Moghra&#39;Yi&quot;,&quot;Brinestalk&quot;),
		(a:&quot;Moghra&#39;Yi&quot;,&quot;Water Dram&quot;),
		(a:&quot;Shrine&quot; ,&quot;Young Ivory&quot;),
		(a:&quot;Shrine&quot; ,&quot;Water Dram&quot;),
		(a:&quot;Shrine&quot; ,&quot;Tonic&quot;),
		(a:&quot;Spindle&quot; ,&quot;Young Ivory&quot;),
		(a:&quot;Spindle&quot; ,&quot;Brinestalk&quot;),
		(a:&quot;Spindle&quot; ,&quot;Water Dram&quot;)
	),
	&quot;positions&quot;,(a:&quot;Wanderer&quot;),
	&quot;effects&quot;,(dm:
		&quot;position&quot;,&quot;Wanderer&quot;
	)
)

))</tw-passagedata><tw-passagedata pid="14" name="Foraging Merchant Roll Results" tags="" position="1200,700" size="100,100">{=
(set: $arFMRollResults to (a:
(dm:
	&quot;ruleName&quot;,&quot;FM Win&quot;,
	&quot;diceSet&quot;,&quot;foraging&quot;,
	&quot;diceResults&quot;,(a:
		(a:&quot;Young Ivory&quot;,&quot;Water Dram&quot;),
		(a:&quot;Water Dram&quot; ,&quot;Water Dram&quot;),
		(a:&quot;Water Dram&quot; ,&quot;Tonic&quot;),
		(a:&quot;Tonic&quot;      ,&quot;Tonic&quot;)
	),
	&quot;positions&quot;,(a:&quot;Merchant&quot;),
	&quot;effects&quot;,(dm:
		&quot;position&quot;,&quot;Win&quot;
	)
),

(dm:
	&quot;ruleName&quot;,&quot;FM Loss&quot;,
	&quot;diceSet&quot;,&quot;foraging&quot;,
	&quot;diceResults&quot;,(a:
		(a:&quot;Young Ivory&quot;,&quot;Young Ivory&quot;)
	),
	&quot;positions&quot;,(a:&quot;Merchant&quot;),
	&quot;effects&quot;,(dm:
		&quot;position&quot;,&quot;Loss&quot;
	)
),

(dm:
	&quot;ruleName&quot;,&quot;FM Become Wanderer&quot;,
	&quot;diceSet&quot;,&quot;foraging&quot;,
	&quot;diceResults&quot;,(a:
		(a:&quot;Young Ivory&quot;,&quot;Brinestalk&quot;),
		(a:&quot;Young Ivory&quot;,&quot;Tonic&quot;),
		(a:&quot;Brinestalk&quot; ,&quot;Water Dram&quot;),
		(a:&quot;Brinestalk&quot; ,&quot;Tonic&quot;)
	),
	&quot;positions&quot;,(a:&quot;Merchant&quot;),
	&quot;effects&quot;,(dm:
		&quot;position&quot;,&quot;Wanderer&quot;
	)
),

(dm:
	&quot;ruleName&quot;,&quot;FM Become Wanderer w/ Merchant Swap&quot;,
	&quot;diceSet&quot;,&quot;foraging&quot;,
	&quot;diceResults&quot;,(a:
		(a:&quot;Brinestalk&quot;,&quot;Brinestalk&quot;)
	),
	&quot;positions&quot;,(a:&quot;Merchant&quot;),
	&quot;opponent&quot;,(dm:
		&quot;positions&quot;,(a:&quot;Wanderer&quot;)
	),
	&quot;priority&quot;,-4,
	&quot;effects&quot;,(dm:
		&quot;position&quot;,&quot;Wanderer&quot;,
		&quot;opponent&quot;,(dm:
			&quot;position&quot;,&quot;Merchant&quot;
		)
	)
),

(dm:
	&quot;ruleName&quot;,&quot;FM Become Wanderer wo/ Merchant Swap&quot;,
	&quot;diceSet&quot;,&quot;foraging&quot;,
	&quot;diceResults&quot;,(a:
		(a:&quot;Brinestalk&quot;,&quot;Brinestalk&quot;)
	),
	&quot;positions&quot;,(a:&quot;Merchant&quot;),
	&quot;opponent&quot;,(dm:
		&quot;positions&quot;,(a:&quot;Merchant&quot;,&quot;Pilgrim&quot;,&quot;Ascendant&quot;)
	),
	&quot;priority&quot;,-4,
	&quot;effects&quot;,(dm:
		&quot;position&quot;,&quot;Wanderer&quot;
	)
)

))</tw-passagedata><tw-passagedata pid="15" name="Scavenging Merchant Roll Results" tags="" position="1400,700" size="100,100">{=
(set: $arSMRollResults to (a:
(dm:
	&quot;ruleName&quot;,&quot;SM Win&quot;,
	&quot;diceSet&quot;,&quot;scavenging&quot;,
	&quot;diceResults&quot;,(a:
		(a:&quot;Moghra&#39;Yi&quot;,&quot;Water Dram&quot;),
		(a:&quot;Moghra&#39;Yi&quot;,&quot;Tonic&quot;)
	),
	&quot;positions&quot;,(a:&quot;Merchant&quot;),
	&quot;effects&quot;,(dm:
		&quot;position&quot;,&quot;Win&quot;
	)
),

(dm:
	&quot;ruleName&quot;,&quot;SM Loss&quot;,
	&quot;diceSet&quot;,&quot;scavenging&quot;,
	&quot;diceResults&quot;,(a:
		(a:&quot;Turret&quot;,&quot;Young Ivory&quot;),
		(a:&quot;Turret&quot;,&quot;Brinestalk&quot;),
		(a:&quot;Moghra&#39;Yi&quot;,&quot;Brinestalk&quot;)
	),
	&quot;positions&quot;,(a:&quot;Merchant&quot;),
	&quot;effects&quot;,(dm:
		&quot;position&quot;,&quot;Loss&quot;
	)
),

(dm:
	&quot;ruleName&quot;,&quot;SM Become Wanderer&quot;,
	&quot;diceSet&quot;,&quot;scavenging&quot;,
	&quot;diceResults&quot;,(a:
		(a:&quot;Turret&quot;,&quot;Water Dram&quot;),
		(a:&quot;Turret&quot;,&quot;Tonic&quot;),
		(a:&quot;Shrine&quot;,&quot;Young Ivory&quot;),
		(a:&quot;Shrine&quot;,&quot;Tonic&quot;),
		(a:&quot;Spindle&quot;,&quot;Young Ivory&quot;),
		(a:&quot;Spindle&quot;,&quot;Brinestalk&quot;),
		(a:&quot;Spindle&quot;,&quot;Tonic&quot;)
	),
	&quot;positions&quot;,(a:&quot;Merchant&quot;),
	&quot;effects&quot;,(dm:
		&quot;position&quot;,&quot;Wanderer&quot;
	)
),

(dm:
	&quot;ruleName&quot;,&quot;SM Become Pilgrim&quot;,
	&quot;diceSet&quot;,&quot;scavenging&quot;,
	&quot;diceResults&quot;,(a:
		(a:&quot;Shrine&quot;,&quot;Brinestalk&quot;)
	),
	&quot;positions&quot;,(a:&quot;Merchant&quot;),
	&quot;effects&quot;,(dm:
		&quot;position&quot;,&quot;Pilgrim&quot;
	)
)

))</tw-passagedata><tw-passagedata pid="16" name="Foraging Pilgrim Roll Results" tags="" position="1200,900" size="100,100">{=
(set: $arFPRollResults to (a:
(dm:
	&quot;ruleName&quot;,&quot;FP Win&quot;,
	&quot;diceSet&quot;,&quot;foraging&quot;,
	&quot;diceResults&quot;,(a:
		(a:&quot;Young Ivory&quot;,&quot;Tonic&quot;),
		(a:&quot;Brinestalk&quot; ,&quot;Tonic&quot;),
		(a:&quot;Water Dram&quot; ,&quot;Tonic&quot;)
	),
	&quot;positions&quot;,(a:&quot;Pilgrim&quot;),
	&quot;effects&quot;,(dm:
		&quot;position&quot;,&quot;Win&quot;
	)
),

(dm:
	&quot;ruleName&quot;,&quot;FP Loss&quot;,
	&quot;diceSet&quot;,&quot;foraging&quot;,
	&quot;diceResults&quot;,(a:
		(a:&quot;Young Ivory&quot;,&quot;Young Ivory&quot;)
	),
	&quot;positions&quot;,(a:&quot;Pilgrim&quot;),
	&quot;effects&quot;,(dm:
		&quot;position&quot;,&quot;Loss&quot;
	)
),

(dm:
	&quot;ruleName&quot;,&quot;FP Become Wanderer&quot;,
	&quot;diceSet&quot;,&quot;foraging&quot;,
	&quot;diceResults&quot;,(a:
		(a:&quot;Brinestalk&quot;,&quot;Brinestalk&quot;),
		(a:&quot;Water Dram&quot;,&quot;Water Dram&quot;),
		(a:&quot;Tonic&quot; ,&quot;Tonic&quot;)
	),
	&quot;positions&quot;,(a:&quot;Pilgrim&quot;),
	&quot;effects&quot;,(dm:
		&quot;position&quot;,&quot;Wanderer&quot;
	)
),

(dm:
	&quot;ruleName&quot;,&quot;FP No Change&quot;,
	&quot;diceSet&quot;,&quot;foraging&quot;,
	&quot;diceResults&quot;,(a:
		(a:&quot;Young Ivory&quot;,&quot;Brinestalk&quot;),
		(a:&quot;Young Ivory&quot;,&quot;Water Dram&quot;),
		(a:&quot;Brinestalk&quot; ,&quot;Water Dram&quot;)
	),
	&quot;positions&quot;,(a:&quot;Pilgrim&quot;),
	&quot;effects&quot;,(dm:
		&quot;position&quot;,&quot;Pilgrim&quot;
	)
)

))</tw-passagedata><tw-passagedata pid="17" name="Scavenging Pilgrim Roll Results" tags="" position="1400,900" size="100,100">{=
(set: $arSPRollResults to (a:
(dm:
	&quot;ruleName&quot;,&quot;SP Win&quot;,
	&quot;diceSet&quot;,&quot;scavenging&quot;,
	&quot;diceResults&quot;,(a:
		(a:&quot;Moghra&#39;Yi&quot;,&quot;Tonic&quot;),
		(a:&quot;Shrine&quot;,&quot;Water Dram&quot;),
		(a:&quot;Shrine&quot;,&quot;Tonic&quot;)
	),
	&quot;positions&quot;,(a:&quot;Pilgrim&quot;),
	&quot;effects&quot;,(dm:
		&quot;position&quot;,&quot;Win&quot;
	)
),

(dm:
	&quot;ruleName&quot;,&quot;SP Loss&quot;,
	&quot;diceSet&quot;,&quot;scavenging&quot;,
	&quot;diceResults&quot;,(a:
		(a:&quot;Turret&quot;,&quot;Young Ivory&quot;),
		(a:&quot;Shrine&quot;,&quot;Young Ivory&quot;)
	),
	&quot;positions&quot;,(a:&quot;Pilgrim&quot;),
	&quot;effects&quot;,(dm:
		&quot;position&quot;,&quot;Loss&quot;
	)
),

(dm:
	&quot;ruleName&quot;,&quot;SP Become Wanderer&quot;,
	&quot;diceSet&quot;,&quot;scavenging&quot;,
	&quot;diceResults&quot;,(a:
		(a:&quot;Turret&quot; ,&quot;Brinestalk&quot;),
		(a:&quot;Turret&quot; ,&quot;Tonic&quot;),
		(a:&quot;Spindle&quot;,&quot;Young Ivory&quot;),
		(a:&quot;Spindle&quot;,&quot;Brinestalk&quot;),
		(a:&quot;Spindle&quot;,&quot;Tonic&quot;)
	),
	&quot;positions&quot;,(a:&quot;Pilgrim&quot;),
	&quot;effects&quot;,(dm:
		&quot;position&quot;,&quot;Wanderer&quot;
	)
),

(dm:
	&quot;ruleName&quot;,&quot;SP No Change&quot;,
	&quot;diceSet&quot;,&quot;scavenging&quot;,
	&quot;diceResults&quot;,(a:
		(a:&quot;Turret&quot;,&quot;Water Dram&quot;),
		(a:&quot;Moghra&#39;Yi&quot;,&quot;Young Ivory&quot;),
		(a:&quot;Moghra&#39;Yi&quot;,&quot;Brinestalk&quot;),
		(a:&quot;Moghra&#39;Yi&quot;,&quot;Water Dram&quot;),
		(a:&quot;Shrine&quot; ,&quot;Brinestalk&quot;),
		(a:&quot;Spindle&quot; ,&quot;Water Dram&quot;)
	),
	&quot;positions&quot;,(a:&quot;Pilgrim&quot;),
	&quot;effects&quot;,(dm:
		&quot;position&quot;,&quot;Pilgrim&quot;
	)
)

))</tw-passagedata><tw-passagedata pid="18" name="Foraging Ascendant Roll Results" tags="" position="1200,1100" size="100,100">{=
(set: $arFARollResults to (a:
(dm:
	&quot;ruleName&quot;,&quot;FA Win&quot;,
	&quot;diceSet&quot;,&quot;foraging&quot;,
	&quot;diceResults&quot;,(a:
		(a:&quot;Young Ivory&quot;,&quot;Tonic&quot;),
		(a:&quot;Brinestalk&quot; ,&quot;Tonic&quot;),
		(a:&quot;Water Dram&quot; ,&quot;Tonic&quot;)
	),
	&quot;positions&quot;,(a:&quot;Ascendant&quot;),
	&quot;effects&quot;,(dm:
		&quot;position&quot;,&quot;Win&quot;
	)
),

(dm:
	&quot;ruleName&quot;,&quot;FA Loss&quot;,
	&quot;diceSet&quot;,&quot;foraging&quot;,
	&quot;diceResults&quot;,(a:
		(a:&quot;Young Ivory&quot;,&quot;Young Ivory&quot;),
		(a:&quot;Brinestalk&quot; ,&quot;Brinestalk&quot;),
		(a:&quot;Tonic&quot;      ,&quot;Tonic&quot;)
	),
	&quot;positions&quot;,(a:&quot;Ascendant&quot;),
	&quot;effects&quot;,(dm:
		&quot;position&quot;,&quot;Loss&quot;
	)
),

(dm:
	&quot;ruleName&quot;,&quot;FA No Change&quot;,
	&quot;diceSet&quot;,&quot;foraging&quot;,
	&quot;diceResults&quot;,(a:
		(a:&quot;Young Ivory&quot;,&quot;Brinestalk&quot;),
		(a:&quot;Young Ivory&quot;,&quot;Water Dram&quot;),
		(a:&quot;Brinestalk&quot; ,&quot;Water Dram&quot;),
		(a:&quot;Water Dram&quot; ,&quot;Water Dram&quot;),
	),
	&quot;positions&quot;,(a:&quot;Ascendant&quot;),
	&quot;effects&quot;,(dm:
		&quot;position&quot;,&quot;Ascendant&quot;
	)
)

))</tw-passagedata><tw-passagedata pid="19" name="Scavenging Ascendant Roll Results" tags="" position="1400,1100" size="100,100">{=
(set: $arSARollResults to (a:
(dm:
	&quot;ruleName&quot;,&quot;SA Win&quot;,
	&quot;diceSet&quot;,&quot;scavenging&quot;,
	&quot;diceResults&quot;,(a:
		(a:&quot;Turret&quot;   ,&quot;Tonic&quot;),
		(a:&quot;Moghra&#39;Yi&quot;,&quot;Young Ivory&quot;),
		(a:&quot;Moghra&#39;Yi&quot;,&quot;Brinestalk&quot;),
		(a:&quot;Moghra&#39;Yi&quot;,&quot;Water Dram&quot;),
		(a:&quot;Moghra&#39;Yi&quot;,&quot;Tonic&quot;),
		(a:&quot;Shrine&quot;   ,&quot;Tonic&quot;)
	),
	&quot;positions&quot;,(a:&quot;Ascendant&quot;),
	&quot;effects&quot;,(dm:
		&quot;position&quot;,&quot;Win&quot;
	)
),

(dm:
	&quot;ruleName&quot;,&quot;SA Loss&quot;,
	&quot;diceSet&quot;,&quot;scavenging&quot;,
	&quot;diceResults&quot;,(a:
		(a:&quot;Turret&quot; ,&quot;Young Ivory&quot;),
		(a:&quot;Turret&quot; ,&quot;Water Dram&quot;),
		(a:&quot;Spindle&quot;,&quot;Young Ivory&quot;),
		(a:&quot;Spindle&quot;,&quot;Brinestalk&quot;),
		(a:&quot;Spindle&quot;,&quot;Tonic&quot;)
	),
	&quot;positions&quot;,(a:&quot;Ascendant&quot;),
	&quot;effects&quot;,(dm:
		&quot;position&quot;,&quot;Loss&quot;
	)
),

(dm:
	&quot;ruleName&quot;,&quot;SA No Change&quot;,
	&quot;diceSet&quot;,&quot;scavenging&quot;,
	&quot;diceResults&quot;,(a:
		(a:&quot;Turret&quot; ,&quot;Brinestalk&quot;),
		(a:&quot;Shrine&quot; ,&quot;Young Ivory&quot;),
		(a:&quot;Shrine&quot; ,&quot;Brinestalk&quot;),
		(a:&quot;Shrine&quot; ,&quot;Water Dram&quot;),
		(a:&quot;Spindle&quot;,&quot;Water Dram&quot;)
	),
	&quot;positions&quot;,(a:&quot;Ascendant&quot;),
	&quot;effects&quot;,(dm:
		&quot;position&quot;,&quot;Ascendant&quot;
	)
)

))</tw-passagedata><tw-passagedata pid="20" name="Result Rule Examiner" tags="" position="1200,300" size="100,100">{=
(set: $dmRecursionHelper to
$dmRecursionHelper + (dm:
&quot;resultRuleCond&quot;,
(macro:
	datamap-type _resultRule,
	datamap-type _gameState,
[
	(set: _cmRuleFieldMatch to $dmRecursionHelper&#39;s ruleFieldMatch)
	(set: _ruleDiceSet to _resultRule&#39;s diceSet)

	(output-data:(folded:
		_ruleField making _cond via (cond:
			_ruleField&#39;s name is &quot;diceSet&quot;,true,
			_ruleField&#39;s name is &quot;effects&quot;,true,
			(_cmRuleFieldMatch:
				_ruleField,
				_gameState,
				_ruleDiceSet
		)) and _cond,
		true,
		...(dataentries: _resultRule)
	))
])))

(set: _cmDiceResultsComp to
(macro:
	array-type _ruleDiceResults,
	array-type _playerDice
[
	(output-data:(folded:_ruleDiceResult making _comp via
		(sorted:_ruleDiceResult) is ($cmDiceResult:_playerDice)
			or _comp,
		false,
		_ruleDiceResults
	))
]))

(set: $dmRecursionHelper to
$dmRecursionHelper + (dm:
&quot;ruleFieldMatch&quot;,
(macro:
	datamap-type _ruleField,
	datamap-type _gameState,
	string-type _ruleDiceSet
[
	(set: _cmResultRuleCond to $dmRecursionHelper&#39;s resultRuleCond)
	(set: _playerState to _ruleDiceSet of _gameState)

	(output-data:(cond:
		_ruleField&#39;s name is &quot;opponent&quot;,(_cmResultRuleCond:
			_ruleField&#39;s value
			+ (dm:&quot;diceSet&quot;,($cmDiceSetInvert:_ruleDiceSet)),
			_gameState
		),
		_ruleField&#39;s name is &quot;diceResults&quot;,
			(_cmDiceResultsComp:_ruleField&#39;s value,_playerState&#39;s dice),
		_ruleField&#39;s name is &quot;positions&quot;,
			_playerState&#39;s position is in _ruleField&#39;s value
	))
])))</tw-passagedata><tw-passagedata pid="21" name="Recursion Setup" tags="startup" position="200,900" size="100,100">{=
&lt;!--
Harlowe doesn&#39;t support recursion by default, as variable names are not bound until after the declaration is checked for correctness. This means that macros cannot refer to themselves or other macros that have yet to be declared.

However, macros can be stored in data structures and then referred to indirectly. This indirection means that macros can call themselves in their declaration.

For example, suppose you want to implement the factorial (!) function recursively.

(set: _factorial to
(macro: num-type _num)[
	(if:_num &lt; 1)[(output-data: 1)]
	(else:)[(output-data: _num * (_factorial: _num - 1))]
]))

This code will error because &quot;_factorial&quot; does not yet have a value in the macro declaration block. We can fix this by creating a global datamap to store the macro and referencing it in the declaration.

(set: $dmRecursionHelper to
(dm:
	&quot;factorial&quot;,(macro: num-type _num)[
		(set: _factorial to $dmRecursionHelper&#39;s factorial)
		(if: _num &lt; 1)[(output-data: 1)]
		(else:)[(output-data: _num * (_factorial: _num - 1))]
	]
))
(set: _cm to $dmRecursionHelper&#39;s factorial)
(print: (_cm: 4))

&gt; 24

--&gt;

(set: $dmRecursionHelper to (dm:))</tw-passagedata><tw-passagedata pid="22" name="Result Rule Applier" tags="" position="1400,300" size="100,100">{=
(set: _cmRuleEffectApp to
(macro:
	datamap-type _ruleEffect,
	datamap-type _gameState,
	string-type _ruleDiceSet,
[
	(set: _playerState to _ruleDiceSet of _gameState)
	(output-data:
		_gameState
		+ (dm:_ruleDiceSet,_playerState + _ruleEffect)
	)
]))

(set: $cmResultRuleApply to
(macro:
	datamap-type _resultRule,
	datamap-type _gameState
[
	(set: _ruleEffects to _resultRule&#39;s effects)
	(output-data:(folded:
		_effectField making _gameState via (cond:
			_effectField&#39;s name is &quot;opponent&quot;,
				_gameState
				+ (_cmRuleEffectApp:
					_effectField&#39;s value,
					_gameState,
					($cmDiceSetInvert:_resultRule&#39;s diceSet)
				),
			_gameState
			+ (_cmRuleEffectApp:
				(dm:_effectField&#39;s name,_effectField&#39;s value),
				_gameState,
				_resultRule&#39;s diceSet
			)
		),
		_gameState,
		...(dataentries:_ruleEffects)
	))
]))</tw-passagedata><tw-passagedata pid="23" name="Choice Rules" tags="" position="1600,500" size="100,100">{=
(set: $arRollChoiceRules to (a:
(dm:
	&quot;ruleName&quot;,&quot;Foraging NoCheat&quot;,
	&quot;diceHand&quot;,&quot;foraging&quot;,
	&quot;mutations&quot;,(a:),
	&quot;cybernetics&quot;,(a:),
	&quot;diceStates&quot;,(a:&quot;NoEffect&quot;),
	&quot;effects&quot;,(a:
		(dm:
			&quot;area&quot;,&quot;player&quot;,
			&quot;rollType&quot;,&quot;fairRoll&quot;,
			&quot;diceType&quot;,&quot;foraging&quot;
		),
		(dm:
			&quot;area&quot;,&quot;opponent&quot;,
			&quot;rollType&quot;,&quot;fairRoll&quot;,
			&quot;diceType&quot;,&quot;foraging&quot;
		)
	),
	&quot;description&quot;,&quot;Roll foraging die in each area&quot;
),

(dm:
	&quot;ruleName&quot;,&quot;Pass Scavenging NoCheat&quot;,
	&quot;diceHand&quot;,&quot;scavenging&quot;,
	&quot;mutations&quot;,(a:),
	&quot;cybernetics&quot;,(a:),
	&quot;diceStates&quot;,(a:&quot;NoEffect&quot;),
	&quot;effects&quot;,(a:
		(dm:
			&quot;area&quot;,&quot;player&quot;,
			&quot;rollType&quot;,&quot;fairRoll&quot;,
			&quot;diceType&quot;,&quot;foraging&quot;
		),
		(dm:
			&quot;area&quot;,&quot;opponent&quot;,
			&quot;rollType&quot;,&quot;fairRoll&quot;,
			&quot;diceType&quot;,&quot;scavenging&quot;
		)
	),
	&quot;description&quot;,&quot;Pass scavenging die, roll foraging&quot;
),

(dm:
	&quot;ruleName&quot;,&quot;Keep Scavenging NoCheat&quot;,
	&quot;diceHand&quot;,&quot;scavenging&quot;,
	&quot;mutations&quot;,(a:),
	&quot;cybernetics&quot;,(a:),
	&quot;diceStates&quot;,(a:&quot;NoEffect&quot;),
	&quot;effects&quot;,(a:
		(dm:
			&quot;area&quot;,&quot;player&quot;,
			&quot;rollType&quot;,&quot;fairRoll&quot;,
			&quot;diceType&quot;,&quot;scavenging&quot;
		),
		(dm:
			&quot;area&quot;,&quot;opponent&quot;,
			&quot;rollType&quot;,&quot;fairRoll&quot;,
			&quot;diceType&quot;,&quot;foraging&quot;
		),
	),
	&quot;description&quot;,&quot;Keep scavenging, pass foraging die&quot;
)

))</tw-passagedata><tw-passagedata pid="24" name="Roll Choice Link Creator" tags="" position="1600,300" size="100,100">{=
(set: $cmFairRollCalc to
(macro: datamap-type _playerState, [
	(set: _dexM to ($cmGetStatValueMod:_playerState&#39;s stat&#39;s DEX))
	(output-data: (cond:
		_dexM &gt;= 1, 1.0,
		(6 + _dexM) * (6 + _dexM) / (6 * 6 + 1)
		+ 0.6 * (1.0 - (6 + _dexM) * (6 + _dexM) / (6 * 6 + 1))
	))
]))

(set: $cmRollOddsCalc to
(macro:
	datamap-type _choiceRule,
	datamap-type _playerState,
[
	(set: _stat to _playerState&#39;s stats)
	(output-data:(folded:_rollEffect making _odds via
		(cond:
			_rollEffect&#39;s rollType is &quot;fairRoll&quot;,
				($cmFairRollCalc:_playerState) * _odds
		),
		1.0,
		..._choiceRule&#39;s effects
	))
]))

(set: $cmChoiceLinkCreate to
(macro:
	datamap-type _choiceRule,
	datamap-type _pcState,
[
	(set: _odds to (round:($cmRollOddsCalc:_choiceRule,_pcState)) * 100)
	(set: _oddsStr to (cond:
		_odds &lt; 100, &quot; [&quot; + (str:_odds) + &quot;%]&quot;,
		&quot;&quot;
	))

	(output:)[
		(link-reveal-goto:
			_choiceRule&#39;s description + _oddsStr,
			&quot;Roll Choice Handler&quot;
		)[(set: $dmPCRollChoice to _choiceRule)]
	]
]))</tw-passagedata><tw-passagedata pid="25" name="Roll Choice Handler" tags="" position="1800,300" size="100,100">{=
(set: $cmRoll to
(macro:
	datamap-type _choiceRule,
	datamap-type _gameState,
	bool-type _pc,
[
	(unpack: _gameState into
		(dm: _gameState&#39;s pc,(dm: &quot;dice&quot;, array-type _pcDice))
	)
	(output-data:
		
	)
]))

(set: $cmRollChoiceHandler to
(macro: [
	(set: $dmGameState to ($cmRoll:$dmPCRollChoice,$dmGameState,true))
	(set: $dmGameState to ($cmRoll:
		(either:($cmRollChoices:$arRollChoiceRules,$dmGameState,false)),
		$dmGameState,
		false
	))
]))</tw-passagedata><tw-passagedata pid="26" name="Creature Editor" tags="" position="400,500" size="100,100">{=
($cmEditorUICreate:$strEditorTarget of $dmCreatures, $strEditorTarget)</tw-passagedata><tw-passagedata pid="27" name="Creature Editor Setup" tags="startup" position="500,600" size="100,100">{=
(set: $cmEditorUICreate to (macro:
	datamap-type _creature,
	string-type _creatureLabel,
[
(output:)[
(box:&quot;=XXX=&quot;)[
(box:&quot;=X=&quot;)[###Information]
=|=
(box:&quot;=XX=&quot;)[&#39;&#39;//Name//&#39;&#39;]
=|=
(box:&quot;=XXXX=&quot;)[(input-box:2bind _creature&#39;s name,&quot;X&quot;,1)]
|==|
]

(box:&quot;=XXX=&quot;)[
(box:&quot;=X=&quot;)[###Attributes]
=|=
(box:&quot;=XX=&quot;)[
	(for: each _stat, ..._creature&#39;s stats)[
		&#39;&#39;//(print:_stat&#39;s name)//&#39;&#39; &lt;br&gt;
	]
]
=|=
(box:&quot;=XX=&quot;)[
	(for: each _i, ...(range:1,_creature&#39;s stats&#39;s length))[
		(dropdown:
			2bind _creature&#39;s stats&#39;s (_i)&#39;s value,
			...$arStatValueRange
		) &lt;br&gt;
	]
]
|==|
]

=|=
(box:&quot;=XXXXX=&quot;)[
(box:&quot;=XX=&quot;)[###Mutations]
* //Todo//
]
=|=
(box:&quot;=XXXXX=&quot;)[
(box:&quot;=XX=&quot;)[###Cybernetics]
* //Todo//
]
|==|

(box:&quot;=XXX=&quot;)[
=|=
(link-reveal-goto:
	&quot;Save &amp; Return&quot;,
	&quot;Main Menu&quot;
)[(set: $dmCreatures to $dmCreatures + (dm:_creatureLabel,_creature))]
=|=
(link-goto:
	&quot;Cancel&quot;,
	&quot;Main Menu&quot;
)
|==|
]
]]))</tw-passagedata></tw-storydata>

